<div class="statistics">
  <div class="page-header">
    <h1 class="page-title">Statistiques</h1>
  </div>

  <div class="loading-state" *ngIf="isLoading">
    <p>Chargement des statistiques...</p>
  </div>

  <div *ngIf="!isLoading">
    <!-- Cartes statistiques -->
    <div class="stats-grid">
      <div class="stat-card" *ngFor="let stat of stats" [ngClass]="'stat-' + stat.color">
        <!-- ... icÃ´nes existantes ... -->
        <div class="stat-content">
          <h3 class="stat-value">{{ stat.value }}</h3>
          <p class="stat-title">{{ stat.title }}</p>
          <p class="stat-label">{{ stat.label }}</p>
        </div>
      </div>

      <!-- âœ… Nouvelle stat : Panier moyen -->
      <div class="stat-card stat-info">
        <div class="stat-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/>
            <line x1="3" y1="6" x2="21" y2="6"/>
            <path d="M16 10a4 4 0 0 1-8 0"/>
          </svg>
        </div>
        <div class="stat-content">
          <h3 class="stat-value">{{ averageBasket }}â‚¬</h3>
          <p class="stat-title">Panier moyen</p>
          <p class="stat-label">par rendez-vous</p>
        </div>
      </div>

      <!-- âœ… Nouvelle stat : Visites moyennes par client -->
      <div class="stat-card stat-primary">
        <div class="stat-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
            <circle cx="12" cy="7" r="4"/>
          </svg>
        </div>
        <div class="stat-content">
          <h3 class="stat-value">{{ averageClientVisits }}</h3>
          <p class="stat-title">Visites moyennes</p>
          <p class="stat-label">par client (annÃ©e)</p>
        </div>
      </div>
    </div>

  <div class="payment-methods-card">
    <div class="payment-header">
      <h2 class="section-title">MÃ©thodes de paiement</h2>
      <div class="payment-summary" *ngIf="paymentMethods && getTotalPayments() > 0">
        <span class="summary-label">Total :</span>
        <span class="summary-value">{{ getTotalPayments() }} paiement{{ getTotalPayments() > 1 ? 's' : '' }}</span>
      </div>
    </div>
    
    <div class="payment-methods-list" *ngIf="paymentMethods && getTotalPayments() > 0">
      <div class="payment-item-card" 
          *ngFor="let method of getPaymentMethodsSorted()" 
          [ngClass]="'payment-card-' + method.key">
        <div class="payment-item-left">
          <div class="payment-icon-wrapper">
            <!-- IcÃ´ne EspÃ¨ces -->
            <svg *ngIf="method.key === 'espÃ¨ces'" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <path d="M12 6v12M9 9h6M9 12h6M9 15h6"/>
            </svg>
            <!-- IcÃ´ne Carte -->
            <svg *ngIf="method.key === 'carte'" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="1" y="4" width="22" height="16" rx="2" ry="2"/>
              <line x1="1" y1="10" x2="23" y2="10"/>
            </svg>
            <!-- IcÃ´ne Virement -->
            <svg *ngIf="method.key === 'virement'" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
              <polyline points="3.27 6.96 12 12.01 20.73 6.96"/>
              <line x1="12" y1="22.08" x2="12" y2="12"/>
            </svg>
            <!-- IcÃ´ne ChÃ¨que -->
            <svg *ngIf="method.key === 'chÃ¨que'" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="2" y="4" width="20" height="16" rx="2" ry="2"/>
              <path d="M6 8h12M6 12h8M6 16h4"/>
            </svg>
          </div>
          <div class="payment-info">
            <h3 class="payment-name">{{ getPaymentMethodLabel(method.key) }}</h3>
            <div class="payment-stats">
              <span class="payment-count">{{ method.count }}</span>
              <span class="payment-label">paiement{{ method.count > 1 ? 's' : '' }}</span>
            </div>
          </div>
        </div>
        
        <div class="payment-item-right">
          <div class="payment-percentage-display">
            <span class="percentage-value">{{ method.percentage | number:'1.0-1' }}%</span>
          </div>
          <div class="payment-progress-wrapper">
            <div class="payment-progress-bar" 
                [style.width.%]="method.percentage"
                [ngClass]="'progress-' + method.key">
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="empty-state" *ngIf="!paymentMethods || getTotalPayments() === 0">
      <div class="empty-icon">ðŸ’³</div>
      <p>Aucun paiement enregistrÃ©</p>
    </div>
  </div>
</div>